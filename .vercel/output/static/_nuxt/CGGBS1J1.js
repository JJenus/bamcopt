import{c as b,n as T,u as g}from"./92L2RCN-.js";import{t as B,V as I}from"./C1v_YKik.js";import{u as x}from"./BR2hkClM.js";import{a as A}from"./CgRmDqS1.js";const k="$s";function u(...e){const f=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(f);const[i,a]=e;if(!i||typeof i!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+i);if(a!==void 0&&typeof a!="function")throw new Error("[nuxt] [useState] init must be a function: "+a);const p=k+i,v=b(),r=B(v.payload.state,p);if(r.value===void 0&&a){const h=a();if(I(h))return v.payload.state[p]=h,h;r.value=h}return r}var E=(e=>(e.ACTIVE="active",e.CLOSED="closed",e.FROZEN="frozen",e))(E||{}),N=(e=>(e.READ="read",e.UNREAD="unread",e))(N||{});const C=()=>{const e={id:"",userId:"",currencyId:"",amount:null,status:E.ACTIVE,accountLevel:0,accountNumber:0},f={id:"",name:"",email:"",imgUrl:"/assets/media/svg/avatars/blank.svg",phone:"",address:"",city:"",country:"",dob:"",verified:!1,emailVerified:!1,account:{id:"",userId:"",currencyId:"",amount:0,status:E.ACTIVE,accountLevel:0,accountNumber:0},userType:"",createdAt:"",idUrl:void 0,cot:void 0,imf:void 0,tax:void 0},i=u("user-transactions",()=>[]),a=u("notifications",()=>[]),p=u("new-notifications",()=>[]),v=u("new-notification",()=>!1),r=u("userData",()=>f),h=u("userAccount",()=>e),w=u("users",()=>[]),t=u("active-user"),y=u("admin",()=>[]);return{account:h,data:r,users:w,admins:y,active:t,notifications:a,newNotifications:p,isNewNotification:v,transactions:i,getUsers:()=>{var o,n,s;(o=m().userData.value)!=null&&o.user||T("/sign-in");const d={method:"get",url:`${g().public.BE_API}/users`,timeout:2e4,headers:{Authorization:"Bearer "+((n=m().userData.value)==null?void 0:n.token)}};console.log("TOKEN ",(s=m().userData.value)==null?void 0:s.token),A.request(d).then(c=>{w.value=c.data.filter(l=>l.userType!=="admin").sort((l,D)=>new Date(D.createdAt).getTime()-new Date(l.createdAt).getTime()),y.value=c.data.filter(l=>l.userType==="admin").sort((l,D)=>new Date(D.createdAt).getTime()-new Date(l.createdAt).getTime())}).catch(c=>{c.response.data.message.includes("Access denied")||c.response.status})},fetchBalance:()=>{var o;const d={method:"get",url:`${g().public.BE_API}/account/${r.value.id}`,timeout:15e3,headers:{Authorization:"Bearer "+((o=m().userData.value)==null?void 0:o.token)}};A.request(d).then(n=>{const s=n.data;h.value=s}).catch(n=>{})},getNotifications:()=>{var o;const d={method:"get",url:`${g().public.BE_API}/notifications/${r.value.id}`,timeout:15e3,headers:{Authorization:"Bearer "+((o=m().userData.value)==null?void 0:o.token)}};A.request(d).then(n=>{a.value=n.data.sort((c,l)=>new Date(l.createdAt).getTime()-new Date(c.createdAt).getTime());const s=a.value.filter(c=>c.status===N.UNREAD?(v.value=!0,!0):!1);v.value&&a.value.length==0&&(p.value=s)}).catch(n=>{})},showNotifications:()=>{var o;if(!v.value)return;const d={method:"put",data:a.value,url:`${g().public.BE_API}/notifications/all`,timeout:25e3,headers:{Authorization:"Bearer "+((o=m().userData.value)==null?void 0:o.token)}};A.request(d).then(n=>{}).catch(n=>{console.log(n)})},reloadUser:()=>{var o,n;(o=m().userData.value)!=null&&o.user||T("/sign-in");const d={method:"get",url:`${g().public.BE_API}/users/${r.value.id}`,timeout:2e4,headers:{Authorization:"Bearer "+((n=m().userData.value)==null?void 0:n.token)}};A.request(d).then(s=>{r.value=s.data,console.log(s.data)}).catch(s=>{s.response.data.message.includes("Access denied")||s.response.status})}}},m=()=>{const e=C(),f=u("user",()=>null),i=u("isAuthenticated",()=>!1),a=x("auth",{maxAge:60*60*24}),p=u("authAction",()=>"login");return{isAuthenticated:()=>{if(i.value)return!0;const t=x("auth");return t.value==null||t.value==null?!1:(i.value=!0,f.value=t.value,e.data.value=t.value.user,e.account.value=t.value.user.account,!0)},userData:f,logout:()=>{f.value=null,i.value=!1,x("auth").value=null;try{window.location.href="/"}catch{}},login:t=>{a.value=t,e.data.value=t.user,e.account.value=t.user.account,f.value=t,i.value=!0;try{t.user.userType==="admin"?window.location.href="/admin":window.location.href="/app"}catch{}},openAuthModal:t=>{p.value=t},userAuth:a}};export{N,C as a,u as b,m as u};
